\documentclass[11pt]{article}
\usepackage{xcolor}
\usepackage[absolute,overlay]{textpos}
\usepackage[left=1.6cm,top=0.0cm,right=1cm,bottom=0.65cm,nohead,nofoot]{geometry}
\usepackage{graphicx}
\usepackage{marvosym}
\usepackage[
    colorlinks=true,
    urlcolor=blue,
    linkcolor=blue,
]{hyperref}
\usepackage[ngerman]{babel}
\usepackage{xhfill}
\usepackage{fetamont}
\usepackage[default,scale=0.95]{opensans}
\usepackage[T1]{fontenc}
\usepackage{tikz}
\usepackage{float}
\usepackage{framed}
\usepackage{mdframed}
\usepackage{enumitem}
\usepackage{shadowtext}
\usepackage{pgffor}
\usepackage{tabularray}
%\usepackage{wsuipa}
\usepackage{setspace}
\usepackage{pdfpages}
\RequirePackage{fontawesome}

\usepackage{lipsum}
\usepackage{blindtext}

\usepackage[
    left = \Large \flqq{},%
    right = \frqq{}\normalsize ,%
    leftsub = \flq{},%
    rightsub = \frq{} %
]{dirtytalk}

\usetikzlibrary{shapes.geometric}
\usepackage[utf8]{inputenc}
\usepackage{ifthen}
\usepackage{fancyhdr}

% company custom color
\definecolor{maincolor}{HTML}{{"{"}}{{.MainColor}}}
\definecolor{sidecolor}{HTML}{{"{"}}{{.SideColor}}}
\definecolor{shadowcolor}{HTML}{{"{"}}{{.ShadowColor}}}
\definecolor{linkcolor}{HTML}{{"{"}}{{.MainColor}}}
\definecolor{scalelinebg}{HTML}{{"{"}}{{.ScaleLineBG}}}
\definecolor{color1}{HTML}{{"{"}}{{.Color1}}}
\definecolor{color2}{HTML}{{"{"}}{{.Color2}}}
\definecolor{color3}{HTML}{{"{"}}{{.Color3}}}
\definecolor{color4}{HTML}{{"{"}}{{.Color4}}}
\definecolor{color5}{HTML}{{"{"}}{{.Color5}}}
\definecolor{maingray}{HTML}{D9D9D9}
%\definecolor{maingray}{HTML}{B9B9B9}
\definecolor{lightgray}{HTML}{D9D9D9}


\hypersetup{colorlinks,
linkcolor=linkcolor,
urlcolor=linkcolor,
}

\setlength{\parindent}{0pt} % Disable paragraph indentation

\newcommand{\checkPar}[2]{%
    \ifthenelse{\equal{#1}{}}{}{%
        {#2}%

        \smallskip

    }%
}

\newcommand{\headerfont}{\Large\ffmfamily\bfseries}

\newcommand{\timeLineHeader}[1]{ {%
    \LARGE\ffmfamily\bfseries\textcolor{maincolor}{#1}}

    \bigskip

}

\newcommand{\colorLine}[1]{\xrfill[0.5ex]{1.5pt}[#1]}

\newcommand{\mainColorLine}{\colorLine{maincolor}}

\newcommand{\twoColorLine}{%
    \colorLine{color1}%
    \colorLine{color2}%
}

\newcommand{\threeColorLine}{%
    \colorLine{color1}%
    \colorLine{color2}%
    \colorLine{color3}%
}

\newcommand{\fourColorLine}{%
    \colorLine{color1}%
    \colorLine{color2}%
    \colorLine{color3}%
    \colorLine{color4}%
}

\newcommand{\fiveColorLine}{%
    \colorLine{color1}%
    \colorLine{color2}%
    \colorLine{color3}%
    \colorLine{color4}%
    \colorLine{color5}%
}

\newcommand{\category}[1]{
    \vspace{5mm}

    {\headerfont #1} {{if .LSALineLatex}} {{.LSALineLatex}} {{else}} \mainColorLine {{end}}

    \medskip

}

\newcommand{\bottomColorLine}[1]{~\xrfill[0.0ex]{1.2pt}[#1]~}

\newcommand{\linepositiontime}[2]{
    {\headerfont #1} \bottomColorLine{maincolor} #2
    \smallskip

    \begin{minipage}{\indentLength}
        ~
    \end{minipage}
}

\newlength{\oldparindent}%
\setlength{\oldparindent}{\parindent}% save old indentation amount

\newcommand{\linepositiontimeThree}[3]{
    \ifx&#3&%
        % #1 is empty
        {\headerfont #1} \bottomColorLine{maincolor} #2
    \else
        % #1 is NOT empty
        \setlength{\parindent}{0em}% zero out indentation
        {\headerfont #3} \normalsize \\
        {\headerfont #1} \bottomColorLine{maincolor} #2
        \setlength{\parindent}{\oldparindent}% return to old indent amount
    \fi
    \smallskip

    \begin{minipage}{\indentLength}
        ~
    \end{minipage}
}

\definecolor{futurecolor}{HTML}{666666}
\newcommand{\linepositiontimefuture}[5]{
    \color{futurecolor}
    \shadowoffset{1pt}
    \shadowcolor{sidecolor!40!white}
%    \shadowrgb{0.8, 0.8, 1}

     \ifx&#5&%
        % #1 is empty
        {\headerfont \shadowtext{#1}} ~\xrfill[0.0ex]{1.2pt}[futurecolor]~ \color{futurecolor}\normalsize#2\normalsize
    \else
        % #1 is NOT empty
        \setlength{\parindent}{0em}% zero out indentation
        {\headerfont \shadowtext{#5}} \normalsize \\
        {\headerfont \shadowtext{#1}} ~\xrfill[0.0ex]{1.2pt}[futurecolor]~ \color{futurecolor}\normalsize#2\normalsize
        \setlength{\parindent}{\oldparindent}% return to old indent amount
    \fi

 %   {\headerfont \shadowtext{\begin{minipage}[l]{.6\outsidePageLength}\begin{spacing}{0.5}#1\end{spacing}\end{minipage}}} \begin{minipage}[l]{.4\outsidePageLength}~\xrfill[0.0ex]{1.2pt}[futurecolor]~ \color{futurecolor}\normalsize#2\normalsize\end{minipage}
    \smallskip

    \begin{minipage}{1.3\indentLength}
        ~
    \end{minipage}
    \begin{minipage}{0.982\insidePageLength}
    {\color{futurecolor} #4} \hfill {\color{futurecolor} \footnotesize #3\normalsize}\\
}

\newcommand{\linefinalgrade}[1]{\checkPar{#1}{ {{$.Label.FinalGrade}}: #1}}

\newcommand{\lineinstitute}[1]{\checkPar{#1}{#1}}

\newcommand{\linepublisher}[1]{\checkPar{#1}{#1}}

\newcommand{\linefocus}[1]{\checkPar{#1}{#1}}

\newcommand{\linecontent}[1]{\checkPar{#1}{#1}}

\newcommand{\linecompany}[1]{\checkPar{#1}{#1}}

\newcommand{\linedescription}[1]{\checkPar{#1}{#1}}

\newcommand{\lineproject}[1]{\checkPar{#1}{\projectIcon~ #1}}

\newcommand{\linerole}[1]{\checkPar{#1}{\roleIcon~ #1}}

%\newcommand{\linequit}[1]{\checkPar{#1}{\smallskip \begin{spacing}{0.5} \color{black} \Large¬\footnotesize~\textit{#1}\normalsize \end{spacing}}}
%\newcommand{\linequit}[1]{\checkPar{#1}{\smallskip \begin{spacing}{0.5} \color{black} \Large\quitIcon\footnotesize~#1\normalsize \end{spacing}}} %this?
\newcommand{\linequit}[1]{\checkPar{#1}{ \color{black} \Large\quitIcon\footnotesize~#1\normalsize }}
%\newcommand{\linequit}[1]{\checkPar{#1}{\smallskip \begin{spacing}{0.5} \color{black} \Large¬\normalsize~#1\normalsize \end{spacing}}}
%\newcommand{\linequit}[1]{\checkPar{#1}{\smallskip \begin{spacing}{0.5} \color{darkgray} \Large¬\footnotesize~#1\normalsize \end{spacing}}}
%\newcommand{\linequit}[1]{\checkPar{#1}{\color{gray} ¬\small~ \textit{#1}\normalsize}}

\newcommand{\linetech}[1]{\checkPar{#1}{\techStackIcon~ #1}
}

\newcommand{\shadowedicon}[1]{
    \shadowoffset{0.7pt}\shadowcolor{shadowcolor!40!white}\shadowtext{#1}
}

\newcommand{\documentlink}[1]{\href{#1}{\shadowedicon{\documentIcon}}~
}

\newcommand{\externallink}[1]{\href{#1}{\shadowedicon{\extlinkIcon}}~
}

\newcommand{\externallinksmall}[1]{\small\href{#1}{\shadowedicon{\extlinkIcon}\normalsize}~
}

\newcommand{\externallinksmallblack}[1]{\footnotesize\href{#1}{\shadowedicon{\color{black}\extlinkIcon}\normalsize}~
}

\newcommand{\documentlinkexample}{\color{linkcolor}\shadowedicon{\documentIcon}\color{black}~
}

\newcommand{\externallinkexample}{\color{linkcolor}\shadowedicon{\extlinkIcon}\color{black}~
}

% icons
%\newcommand{\projectIcon}{\includegraphics[width=3mm]{{print "{" $.Icon.Project "}"}} }
\newcommand{\projectIcon}{\normalsize\faCheckSquareO\normalsize}
%\newcommand{\roleIcon}{\includegraphics[width=3mm]{{print "{" $.Icon.Role "}"}} }
%\newcommand{\roleIcon}{\faUser}
\newcommand{\roleIcon}{\faCommentsO}
%\newcommand{\quitIcon}{\includegraphics[width=3mm]{{print "{" $.Icon.Role "}"}} }
%\newcommand{\quitIcon}{¬}
\newcommand{\quitIcon}{\small\faCalendarTimesO\normalsize}
%\newcommand{\quitIcon}{\faHourglassEnd}
%\newcommand{\techStackIcon}{\includegraphics[width=3mm]{{print "{" $.Icon.TechStack "}"}} }
\newcommand{\techStackIcon}{\small\faGears\normalsize}
%\newcommand{\documentIcon}{\includegraphics[width=3mm]{{print "{" $.Icon.Document "}"}}}
%\newcommand{\documentIcon}{\faFilePdfO} % these icons should not have a white background because of sidepart
\newcommand{\documentIcon}{\faFileTextO} % these icons should not have a white background because of sidepart
%\newcommand{\extlinkIcon}{\includegraphics[width=3mm]{{print "{" $.Icon.ExtLink "}"}}}
\newcommand{\extlinkIcon}{\faExternalLink} % these icons should not have a white background because of sidepart

% Command for printing the contact information icons
\newcommand{\icon}[1]{%
    \tikz[baseline=(char.base)]{
        \node[shape=circle,draw,inner sep=1pt, fill=maincolor,maincolor,text=white] (char) {#1};
    }%
}
% Command for printing the contact information icons
\newcommand{\iconFA}[1]{%
    \tikz[baseline=(char.base)]{
        \node[shape=circle,draw,inner sep=1pt, fill=maincolor,maincolor,text=white] (char) {\small#1\normalsize};
%        \node[shape=circle,draw,inner sep=1pt, fill=scalelinebg,scalelinebg,text=maincolor] (char) {#1};
    }%
}

\newcommand{\backgroundColorForSideBar}{%
    % color background for side bar
    \begin{tikzpicture}[remember picture,overlay]
        \node [rectangle, fill=sidecolor, anchor=north, minimum width=9cm, minimum height=\paperheight+1cm] (box) at (0cm,0.5cm){};
    \end{tikzpicture}
}

\newcommand{\linerating}[2]{
    #1
    &
    \begin{tikzpicture}
        \draw[fill=scalelinebg,scalelinebg] (0,0) rectangle (1,0.3);
        \draw[fill=white,maincolor](0,0) rectangle (#2/10,0.3);
    \end{tikzpicture}
    \\[1ex]
}

\newlength{\mylminTitle}
\newlength{\mylmin}
\newlength{\mylmax}
\newlength{\mylminhalf}
\newlength{\mylmaxhalf}
\newlength{\halfminmaxdelta}
\newlength{\mysinglelabel}
\newlength{\singlelabelhalf}

\newcommand{\linerange}[9]{
    \begin{minipage}[b]{\linewidth}#1:
    \end{minipage}%
%
%    \smallskip
%
    \settowidth{\mylminTitle}{#1}
    \settowidth{\mylmin}{#7}
    \settowidth{\mylmax}{#8}
    \setlength{\mylminhalf}{-0.5\mylmin}
    \setlength{\mylmaxhalf}{-0.5\mylmax}
%
%    \the\mylmin \\
%    \the\mylmax \\
%    #9 \\
%    \the\linewidth \\
%    \the\mylminTitle \\
%    \the\mylminhalf \\
%    \the\mylmaxhalf \\
%
    %TODO end RangeText
    \begin{tikzpicture}
    \draw[fill=scalelinebg,scalelinebg] (0,0) rectangle (5,0.3);
    \draw[fill=white,maincolor] (5*#2,0) rectangle (5*#3,0.3);
    \end{tikzpicture}

    %\begin{mdframed}[linecolor=blue,innermargin=0cm]    \end{mdframed}

    \ifcase\pdfstrcmp{#8}{}
        \begin{minipage}[b]{#4\linewidth} \hphantom{}
        \end{minipage}%
        \begin{minipage}[b]{#9\linewidth} \hphantom{}
        \end{minipage}%
        \begin{minipage}[b]{#9\linewidth}\hspace*{\mylminhalf}\small \mbox{#7} \normalsize
        \end{minipage}%
        \begin{minipage}[b]{0.00001\linewidth} \hphantom{}
        \end{minipage}%
    \else
        \begin{minipage}[b]{#4\linewidth} \hphantom{}
        \end{minipage}%
        \begin{minipage}[b]{#5\linewidth}\hspace*{\mylminhalf}\small \mbox{#7} \normalsize
        \end{minipage}%
        \begin{minipage}[b]{#6\linewidth}\hspace*{\mylmaxhalf}\small \mbox{#8} \normalsize
        \end{minipage}%
        \begin{minipage}[b]{0.00001\linewidth} \hphantom{}
        \end{minipage}%
    \fi
%
    \\[3pt]
%    \smallskip
%    \smallskip
}

% header/footer:
\pagestyle{fancy} % Disable headers
\renewcommand{\headrulewidth}{0pt}
\cfoot{}
\rfoot{%
    \footnotesize
    \begin{minipage}[t]{0.3\textwidth} \hphantom{}
    \end{minipage}
    \begin{minipage}[t]{0.7\textwidth}\vspace*{-1cm}
        \begin{flushright}
            {{if $.HasDocumentLinks}}\documentIcon{}\footnotesize~ {{$.Label.DocumentLinks}} ~~~~ {{end}} %
            {{if $.HasExternalLinks}}\extlinkIcon{}\footnotesize~ {{$.Label.ExternalLinks}} {{if (or (eq $.HasLegendCount 5) (eq $.HasLegendCount 4))}} \\ {{else}} ~~~~ {{end}} {{end}} %
            {{if $.HasProject}} \projectIcon{}\footnotesize~ {{$.Label.SomeProjects}} {{if (and (not $.HasExternalLinks) (or (eq $.HasLegendCount 5) (eq $.HasLegendCount 4)))}} \\ {{else}} ~~~~ {{end}} {{end}} %
            {{if $.HasRole}}\roleIcon{}\footnotesize~ {{$.Label.SomeRoles}} ~~~~ {{end}} %
            {{if $.HasTechStack}}\techStackIcon{}\footnotesize~ {{$.Label.UsedTechs}} {{end}} %
        \end{flushright}
    \end{minipage}
    \normalsize
}

\begin{document}
    \normalfont

    \setlength{\TPHorizModule}{1cm} % Left margin
    \setlength{\TPVertModule}{1cm} % Top margin

    \newlength\imagewidth
    \newlength\imagescale
    \pgfmathsetlength{\imagewidth}{5cm}
    \pgfmathsetlength{\imagescale}{\imagewidth/600}
    \newlength\indentLength
    \newlength\outsidePageLength
    \newlength\insidePageLength
    \newlength\insidePageLengthSubIndent

    %------------------------------------------------
    %---- cover letter
    %------------------------------------------------
    {{if .CoverLetter}}
        \thispagestyle{empty}
        {{.CoverLetter}}
        \newpage
    {{end}}

    %------------------------------------------------
    %---- first page
    %------------------------------------------------
    {{ if .HasSideOne }}
        \backgroundColorForSideBar
        \begin{textblock}{5.1}(0.5, 0.2)
            \raggedright

            % profile picture
            \begin{center}
                \begin{tikzpicture}[x=\imagescale,y=-\imagescale]
                    \clip (600/2, 567/2) circle (567/2);
                    \node[anchor=north west, inner sep=0pt, outer sep=0pt] at (0,0) {\includegraphics[width=\imagewidth]{{print "{" .Image "}"}}};
                \end{tikzpicture}
            \end{center}

            % Name
            {\Huge {{.Name}}}

            \smallskip

            {{.Title}}

            \medskip

            % contact infos
            \renewcommand{\arraystretch}{1.2}
            \begin{tabular}{@{}p{0.5cm} @{\hskip 0.2cm}p{43mm}@{}}
            {{if .Nationality}}%
%            \icon{\Mundus} \iconFA{\faGlobe}  & {{.Nationality}}  \\
                \iconFA{\faGlobe}  & {{.Nationality}}  \\[.5ex]
            {{end}}%
            {{if .Location}}%
%            \icon{\Letter} \iconFA{\faEnvelopeO}  & {{.Location}}  \\
                \iconFA{\faEnvelopeO}  & \mbox{{print "{" .Location "}" }}  \\[.5ex]
            {{end}}%
%            \icon{\Email} & \href{mailto:{{print "" .Email "" }}}{{print "{" .Email "}" }} \\
                %TODO improve
%                \iconFA{\faAt} & \href{mailto:{{print "" .Email "" }}}{{print "{" .Email "}" }} \\[.5ex]
                \iconFA{\faAt} & \small\href{mailto:{{print "" .Email "" }}}{{print "{" .Email "}" }}\normalsize \\[.5ex]
%            \icon{\Email}   & {{.Email}}    \\
%            \icon{\Telefon} & {{.Phone}}    \\[1ex]
                \iconFA{\faPhone} & {{.Phone}}    \\[1ex]
            {{if .Websites}}%
                                &
                {{range .Websites}}%
%                \mbox{\LARGE \href{{print "{" .Url "}" }}{{print "{" .FontAwesome "}" }}\normalsize~~}
                    \Large \href{{print "{" .Url "}" }}{{print "{" .FontAwesome "}" }}\normalsize ~
%                \href{{print "{" .Url "}" }}{\includegraphics[width=5mm]{{print "{" .Icon "}"}}}
%                {{end}}\\
            {{end}}%
            \end{tabular}

%            \medskip

            {{.SideOneLSA}}

        \end{textblock}
        \begin{textblock}{14.5}(6.5, 0.5)
             % config length
            \pgfmathsetlength{\indentLength}{5mm}
            \pgfmathsetlength{\outsidePageLength}{140mm}
            \pgfmathsetlength{\insidePageLength}{135mm}
            \pgfmathsetlength{\insidePageLengthSubIndent}{132mm}

            {{range .SideOneRSA }}
                \timeLineHeader{{print "{" .Label "}"}}

                \begin{minipage}{\indentLength}
                    ~
                \end{minipage}
                \begin{minipage}{\outsidePageLength}
                    {{ range .TexList }}
                        {{.}}
                    {{end}}
                \end{minipage}
            {{end}}
        \end{textblock}
    {{end}}

    %------------------------------------------------
    %---- second page
    %------------------------------------------------
    {{ if .HasSideTwo }}
        \newpage
        \backgroundColorForSideBar
        \begin{textblock}{5.1}(0.5, 0.2)
            \medskip
            {{.SideTwoLSA}}

        \end{textblock}
        \begin{textblock}{14.5}(6.5, 0.5)
            % config length
            \pgfmathsetlength{\indentLength}{5mm}
            \pgfmathsetlength{\outsidePageLength}{140mm}
            \pgfmathsetlength{\insidePageLength}{135mm}
            \pgfmathsetlength{\insidePageLengthSubIndent}{132mm}

            {{range .SideTwoRSA }}
                \timeLineHeader{{print "{" .Label "}"}}

                \begin{minipage}{\indentLength}
                    ~
                \end{minipage}
                \begin{minipage}{\outsidePageLength}
                    {{ range .TexList }}
                        {{.}}
                    {{end}}
                \end{minipage}
            {{end}}

        \end{textblock}
    {{end}}

    %------------------------------------------------
    %---- attachments
    %------------------------------------------------
    {{if .Attachment}}

        {{if .AttachmentAndHintsPage}}
            \newpage
            \rfoot{}
            \topskip0pt
        %    \vspace*{200pt}
            \vspace*{\fill}
            \begin{center}
                \begin{minipage}[b]{0.7\linewidth}
                    \begin{center}
                        % TODO multilanguage
                        {\headerfont{{print "{" $.Label.AttachmentTitle "}"}}} \\[10ex]

                        {{$.Label.AttachmentParaIntro}} \\[5ex]
                        \documentlinkexample{} {{$.Label.AttachmentParaDocuments}} \\[3ex]
                        \externallinkexample{} {{$.Label.AttachmentParaLinks}} \\[5ex]

                        {{$.Label.AttachmentParaOutro}}
                    \end{center}
                \end{minipage}
            \end{center}
            \vspace*{\fill}
        {{end}}%

        {{range .Attachment}}
            \newpage
            \includepdf[pages={-}]{{print "{" . "}"}}
        {{end}}%
        % TODO: remove empty page here!
    {{end}}%
%
\end{document}
